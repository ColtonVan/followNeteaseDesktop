{"version":3,"sources":["webpack:///./src/views/updateMusicList.vue","webpack:///./src/views/updateMusicList.vue?9278","webpack:///./src/views/updateMusicList.vue?155b","webpack:///./src/views/updateMusicList.vue?a84b"],"names":["class","navs","type","name","tags","item","key","id","modalVisible","length","ref","rows","maxlength","desc","handleSave","$router","back","width","height","src","imgFile","alt","handleEditCover","title","modalConfirm","visible","bodyStyle","bodyClass","tagList","tagsIndex","tagLabelNames","find","nameIndex","tag","clickTagItem","active","components","HorizontalNav","setup","route","store","state","mergedTagList","reduce","pre","formData","commonToast","playListDetail","descRef","getPlayListDetail","query","then","res","code","playlist","coverImgUrl","description","init","fileUploader","select","handleCallback","files","FormData","append","reader","FileReader","readAsDataURL","onload","event","target","result","img","Image","naturalWidth","newV","focus","immediate","warn","map","join","success","get","dispatch","msg","catch","err","getHighqualityTags","pre2","item2","item3","category","includes","item4","filter","item5","render","__scopeId"],"mappings":"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","file":"js/chunk-5875f708.bca48906.js","sourcesContent":["<template>\r\n    <div class=\"px-5 py-4\">\r\n        <horizontal-nav :navs=\"navs\" />\r\n        <div class=\"d-flex mt-5\">\r\n            <div class=\"editForm d-flex flex-column align-items-start\">\r\n                <label>\r\n                    <span class=\"labelName\">歌单名：</span>\r\n                    <input type=\"text\" class=\"flex-grow-1\" v-model=\"name\" />\r\n                </label>\r\n                <label>\r\n                    <span class=\"labelName\">标签：</span>\r\n                    <div class=\"d-flex align-items-center position-relative\">\r\n                        <div v-for=\"item in tags\" :key=\"item.id\" class=\"rounded-pill border text-muted px-2 me-2 flex-center\">\r\n                            {{ item.name || item }}\r\n                        </div>\r\n                        <div @click=\"modalVisible = true\" class=\"colorA cursor-pointer\" :class=\"{ 'ms-4': tags.length }\">\r\n                            添加标签\r\n                        </div>\r\n                    </div>\r\n                </label>\r\n                <label class=\"position-relative\">\r\n                    <span class=\"labelName\">简介：</span>\r\n                    <div class=\"textareaOuter w-100 pb-3\">\r\n                        <textarea ref=\"descRef\" rows=\"5\" class=\"flex-grow-1 w-100\" maxlength=\"1000\" v-model=\"desc\" />\r\n                    </div>\r\n                    <span class=\"position-absolute bottom-0 text-muted remainLength\">{{ 1000 - desc.length }}</span>\r\n                </label>\r\n                <div class=\"d-flex opBtns mt-5\">\r\n                    <div @click=\"handleSave\" class=\"opBtn saveBtn rounded-pill text-white\">保 存</div>\r\n                    <div @click=\"$router.back()\" class=\"opBtn cancelBtn border rounded-pill ms-4\">取 消</div>\r\n                </div>\r\n            </div>\r\n            <div class=\"ms-5 ps-5 d-flex flex-column align-items-center\">\r\n                <img class=\"rounded-3 coverImg\" width=\"160\" height=\"160\" :src=\"imgFile\" alt=\"\" />\r\n                <div @click=\"handleEditCover\" class=\"opBtn cancelBtn rounded-pill border mt-4\">编辑封面</div>\r\n            </div>\r\n        </div>\r\n    </div>\r\n    <CommonModal\r\n        title=\"添加标签\"\r\n        @confirm=\"modalConfirm\"\r\n        v-model:visible=\"modalVisible\"\r\n        bodyStyle=\"min-height: 220px\"\r\n        bodyClass=\"w-100 overflow-scroll hideScrollBar\"\r\n    >\r\n        <div class=\"text-black-50 mb-3\">选择合适的标签，最多可以选<span class=\"maxTagSum\">3</span>个</div>\r\n        <div class=\"d-flex justify-content-between w-100 mb-2\" v-for=\"(tags, tagsIndex) in tagList\" :key=\"tagsIndex\">\r\n            <div class=\"tagLabelName text-black-50 flex-grow-1 flex-shrink-0\">\r\n                {{ tagLabelNames.find((name, nameIndex) => nameIndex == tagsIndex) }}\r\n            </div>\r\n            <div class=\"d-flex flex-wrap tags\">\r\n                <div class=\"tagItem mb-2 d-flex justify-content-start\" v-for=\"tag in tags\" :key=\"tag.name\">\r\n                    <div\r\n                        @click=\"clickTagItem(tag)\"\r\n                        :class=\"{ activeTagInner: tag.active }\"\r\n                        class=\"tagInner rounded-pill flex-center text-ellipsis cursor-pointer\"\r\n                    >\r\n                        {{ tag.name }}\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    </CommonModal>\r\n    <CommonToast ref=\"commonToast\" />\r\n</template>\r\n\r\n<script lang=\"ts\">\r\nimport HorizontalNav, { NavsProps } from \"@/components/viewParts/HorizontalNav.vue\";\r\nimport { computed, ComputedRef, defineComponent, nextTick, reactive, ref, Ref, toRefs, watch } from \"vue\";\r\nimport { FileSelector } from \"@/utils/file\";\r\nimport { updatePlayListCoverApi, getHighqualityTagsApi, getPlayListDetailApi, updatePlayListApi } from \"@/api/playList\";\r\nimport { useRoute, useRouter } from \"vue-router\";\r\nimport { AxiosResponseProps } from \"@/utils/request\";\r\nimport { useStore } from \"vuex\";\r\ninterface stateProps {\r\n    navs: NavsProps[];\r\n    tags: {}[];\r\n    name: string;\r\n    desc: string;\r\n    imgFile: string;\r\n    formData: FormData;\r\n    tagList: any[];\r\n    modalVisible: boolean;\r\n    tagLabelNames: string[];\r\n    commonToast: Ref;\r\n    mergedTagList: ComputedRef;\r\n    playListDetail: object;\r\n    descRef: Ref;\r\n}\r\nexport default defineComponent({\r\n    components: { HorizontalNav },\r\n    setup() {\r\n        const route = useRoute();\r\n        const router = useRouter();\r\n        const store = useStore();\r\n        const state = reactive<stateProps>({\r\n            navs: [\r\n                {\r\n                    title: \"编辑歌单信息\",\r\n                    active: true,\r\n                },\r\n            ],\r\n            tags: [],\r\n            tagList: [],\r\n            mergedTagList: computed(() => state.tagList.reduce((pre, item) => [...pre, ...item], [])),\r\n            tagLabelNames: [\"语种\", \"风格\", \"场景\", \"情感\", \"主题\"],\r\n            name: \"\",\r\n            desc: \"\",\r\n            imgFile: \"https://p1.music.126.net/jWE3OEZUlwdz0ARvyQ9wWw==/109951165474121408.jpg\",\r\n            formData: null,\r\n            modalVisible: false,\r\n            commonToast: ref(null),\r\n            playListDetail: {},\r\n            descRef: ref(null),\r\n        });\r\n        const getPlayListDetail = () => {\r\n            getPlayListDetailApi({ id: route.query.id }).then((res: any) => {\r\n                if (res.code === 200) {\r\n                    state.playListDetail = res.playlist;\r\n                    state.imgFile = state.playListDetail.coverImgUrl;\r\n                    state.name = state.playListDetail.name || \"\";\r\n                    state.desc = state.playListDetail.description || \"\";\r\n                    state.tags = state.playListDetail.tags || [];\r\n                }\r\n            });\r\n        };\r\n        let handleEditCover;\r\n        const init = () => {\r\n            getPlayListDetail();\r\n            let fileUploader = new FileSelector();\r\n            handleEditCover = () => {\r\n                fileUploader.select();\r\n            };\r\n            fileUploader.handleCallback((files: FileList) => {\r\n                // if (files[0].size / 1000 / 1024 > 1) return state.commonToast.warn(\"上传文件不得大于1mb\");\r\n                state.formData = new FormData();\r\n                state.formData.append(\"id\", route.query.id as string);\r\n                state.formData.append(\"imgFile\", files[0]);\r\n                const reader = new FileReader();\r\n                reader.readAsDataURL(files[0]);\r\n                reader.onload = (event: Event) => {\r\n                    state.imgFile = (event.target as FileReader).result as string;\r\n                    let img = new Image();\r\n                    img.src = state.imgFile;\r\n                    img.onload = () => {\r\n                        state.formData.append(\"imgSize\", img.width || img.naturalWidth || 300);\r\n                    };\r\n                };\r\n            });\r\n        };\r\n        watch(\r\n            () => route.query,\r\n            newV => {\r\n                init();\r\n                if (newV.desc == \"true\") {\r\n                    nextTick(() => {\r\n                        state.descRef.focus();\r\n                    });\r\n                }\r\n            },\r\n            {\r\n                immediate: true,\r\n            }\r\n        );\r\n        const handleSave = () => {\r\n            //更新歌单\r\n            const { name, tags, desc } = state;\r\n            if (!name) return state.commonToast.warn(\"歌单名不能为空\");\r\n            updatePlayListApi({ name, tags: tags.map(item => item.name).join(\";\"), desc, id: route.query.id as string }).then(\r\n                (res: AxiosResponseProps) => {\r\n                    if (res.code === 200) {\r\n                        state.commonToast.success(\"歌单信息更新成功\");\r\n                        //   //上传封面\r\n                        if (!state.formData || !state.formData.get(\"imgFile\")) {\r\n                            init();\r\n                            return store.dispatch(\"getCreatedMusicList\");\r\n                        }\r\n                        updatePlayListCoverApi(state.formData)\r\n                            .then((res: AxiosResponseProps) => {\r\n                                if (res.code === 200) {\r\n                                    init();\r\n                                    store.dispatch(\"getCreatedMusicList\");\r\n                                    state.commonToast.success(\"歌单封面更新成功\");\r\n                                } else {\r\n                                    state.commonToast.success(res.msg || \"歌单封面更新失败,可能原因为图片过大\");\r\n                                }\r\n                            })\r\n                            .catch(err => {\r\n                                state.commonToast.success(err.msg || \"歌单封面更新失败,可能原因为图片过大\");\r\n                            });\r\n                    }\r\n                }\r\n            );\r\n        };\r\n        const getHighqualityTags = () => {\r\n            getHighqualityTagsApi().then((res: any) => {\r\n                if (res.code === 200) {\r\n                    state.tagList = res.tags\r\n                        //确认category的个数\r\n                        .reduce((pre2, item2) => (pre2.map(item3 => item3.category).includes(item2.category) ? pre2 : [...pre2, item2]), [])\r\n                        //把category相同的tag放入当前项\r\n                        .map(item4 => res.tags.filter(item5 => item5.category == item4.category));\r\n                }\r\n            });\r\n        };\r\n        getHighqualityTags();\r\n        const modalConfirm = () => {\r\n            state.tags = [...state.mergedTagList.filter(item => item.active)];\r\n            state.modalVisible = false;\r\n        };\r\n        const clickTagItem = tag => {\r\n            if (tag.active) {\r\n                tag.active = false;\r\n            } else {\r\n                if (state.mergedTagList.filter(item => item.active).length < 3) {\r\n                    tag.active = true;\r\n                } else {\r\n                    state.commonToast.warn(\"最多可选三个标签\");\r\n                }\r\n            }\r\n        };\r\n        return {\r\n            ...toRefs(state),\r\n            handleEditCover,\r\n            handleSave,\r\n            modalConfirm,\r\n            clickTagItem,\r\n        };\r\n    },\r\n});\r\n</script>\r\n\r\n<style scoped lang=\"scss\">\r\n.editForm {\r\n    width: 500px;\r\n    label {\r\n        display: flex;\r\n        width: 100%;\r\n    }\r\n    label ~ label {\r\n        margin-top: 16px;\r\n    }\r\n    input {\r\n        height: 26px;\r\n        border: 1px solid #ccc;\r\n    }\r\n    textarea {\r\n        resize: none;\r\n        @extend .hideScrollBar;\r\n        border: none;\r\n    }\r\n    .textareaOuter {\r\n        border: 1px solid #ccc;\r\n        border-radius: 2.4px;\r\n    }\r\n    input,\r\n    textarea {\r\n        outline: none;\r\n        border-radius: 2.4px;\r\n    }\r\n    .labelName {\r\n        display: inline-block;\r\n        width: 60px;\r\n        text-align: right;\r\n        padding-top: 4px;\r\n        padding-right: 6px;\r\n        flex-shrink: 0;\r\n    }\r\n    .remainLength {\r\n        right: 6px;\r\n    }\r\n}\r\n.opBtns {\r\n    margin-left: 60px;\r\n}\r\n.opBtn {\r\n    width: 90px;\r\n    height: 34px;\r\n    @extend .flex-center;\r\n    cursor: pointer;\r\n    position: relative;\r\n    &:hover {\r\n        &::before {\r\n            position: absolute;\r\n            border-radius: 50rem;\r\n            content: \"\";\r\n            width: 100%;\r\n            height: 100%;\r\n            background-color: rgba($color: #000000, $alpha: 0.05);\r\n        }\r\n    }\r\n}\r\n.coverImg {\r\n    object-fit: cover;\r\n}\r\n.tagLabelName {\r\n}\r\n.tags {\r\n    width: 360px;\r\n    .tagItem {\r\n        width: 90px;\r\n        .tagInner {\r\n            white-space: nowrap;\r\n            width: 68px;\r\n            height: 28px;\r\n        }\r\n        .activeTagInner {\r\n            background-color: rgb(245, 245, 245);\r\n            position: relative;\r\n        }\r\n    }\r\n}\r\n\r\n.primaryTheme {\r\n    .saveBtn {\r\n        background-color: $primary;\r\n    }\r\n    .maxTagSum,\r\n    .tagItem:hover,\r\n    .activeTagInner {\r\n        color: $primary;\r\n    }\r\n    .activeTagInner {\r\n        &:hover {\r\n            &:before {\r\n                position: absolute;\r\n                content: \"×\";\r\n                font-size: 18px;\r\n                right: 4px;\r\n                top: 48%;\r\n                transform: translateY(-50%);\r\n                color: $primary;\r\n            }\r\n        }\r\n    }\r\n}\r\n.darkTheme {\r\n    .saveBtn {\r\n        background-color: $dark;\r\n    }\r\n    .maxTagSum,\r\n    .tagItem:hover,\r\n    .activeTagInner {\r\n        color: $primary;\r\n    }\r\n    .activeTagInner {\r\n        &:hover {\r\n            &:before {\r\n                position: absolute;\r\n                content: \"×\";\r\n                font-size: 18px;\r\n                right: 4px;\r\n                top: 48%;\r\n                transform: translateY(-50%);\r\n                color: $primary;\r\n            }\r\n        }\r\n    }\r\n}\r\n.freeTheme {\r\n    .saveBtn {\r\n        background-color: $free;\r\n    }\r\n    .maxTagSum,\r\n    .tagItem:hover,\r\n    .activeTagInner {\r\n        color: $free;\r\n    }\r\n    .activeTagInner {\r\n        &:hover {\r\n            &:before {\r\n                position: absolute;\r\n                content: \"×\";\r\n                font-size: 18px;\r\n                right: 4px;\r\n                top: 48%;\r\n                transform: translateY(-50%);\r\n                color: $free;\r\n            }\r\n        }\r\n    }\r\n}\r\n</style>\r\n","\r\nimport HorizontalNav, { NavsProps } from \"@/components/viewParts/HorizontalNav.vue\";\r\nimport { computed, ComputedRef, defineComponent, nextTick, reactive, ref, Ref, toRefs, watch } from \"vue\";\r\nimport { FileSelector } from \"@/utils/file\";\r\nimport { updatePlayListCoverApi, getHighqualityTagsApi, getPlayListDetailApi, updatePlayListApi } from \"@/api/playList\";\r\nimport { useRoute, useRouter } from \"vue-router\";\r\nimport { AxiosResponseProps } from \"@/utils/request\";\r\nimport { useStore } from \"vuex\";\r\ninterface stateProps {\r\n    navs: NavsProps[];\r\n    tags: {}[];\r\n    name: string;\r\n    desc: string;\r\n    imgFile: string;\r\n    formData: FormData;\r\n    tagList: any[];\r\n    modalVisible: boolean;\r\n    tagLabelNames: string[];\r\n    commonToast: Ref;\r\n    mergedTagList: ComputedRef;\r\n    playListDetail: object;\r\n    descRef: Ref;\r\n}\r\nexport default defineComponent({\r\n    components: { HorizontalNav },\r\n    setup() {\r\n        const route = useRoute();\r\n        const router = useRouter();\r\n        const store = useStore();\r\n        const state = reactive<stateProps>({\r\n            navs: [\r\n                {\r\n                    title: \"编辑歌单信息\",\r\n                    active: true,\r\n                },\r\n            ],\r\n            tags: [],\r\n            tagList: [],\r\n            mergedTagList: computed(() => state.tagList.reduce((pre, item) => [...pre, ...item], [])),\r\n            tagLabelNames: [\"语种\", \"风格\", \"场景\", \"情感\", \"主题\"],\r\n            name: \"\",\r\n            desc: \"\",\r\n            imgFile: \"https://p1.music.126.net/jWE3OEZUlwdz0ARvyQ9wWw==/109951165474121408.jpg\",\r\n            formData: null,\r\n            modalVisible: false,\r\n            commonToast: ref(null),\r\n            playListDetail: {},\r\n            descRef: ref(null),\r\n        });\r\n        const getPlayListDetail = () => {\r\n            getPlayListDetailApi({ id: route.query.id }).then((res: any) => {\r\n                if (res.code === 200) {\r\n                    state.playListDetail = res.playlist;\r\n                    state.imgFile = state.playListDetail.coverImgUrl;\r\n                    state.name = state.playListDetail.name || \"\";\r\n                    state.desc = state.playListDetail.description || \"\";\r\n                    state.tags = state.playListDetail.tags || [];\r\n                }\r\n            });\r\n        };\r\n        let handleEditCover;\r\n        const init = () => {\r\n            getPlayListDetail();\r\n            let fileUploader = new FileSelector();\r\n            handleEditCover = () => {\r\n                fileUploader.select();\r\n            };\r\n            fileUploader.handleCallback((files: FileList) => {\r\n                // if (files[0].size / 1000 / 1024 > 1) return state.commonToast.warn(\"上传文件不得大于1mb\");\r\n                state.formData = new FormData();\r\n                state.formData.append(\"id\", route.query.id as string);\r\n                state.formData.append(\"imgFile\", files[0]);\r\n                const reader = new FileReader();\r\n                reader.readAsDataURL(files[0]);\r\n                reader.onload = (event: Event) => {\r\n                    state.imgFile = (event.target as FileReader).result as string;\r\n                    let img = new Image();\r\n                    img.src = state.imgFile;\r\n                    img.onload = () => {\r\n                        state.formData.append(\"imgSize\", img.width || img.naturalWidth || 300);\r\n                    };\r\n                };\r\n            });\r\n        };\r\n        watch(\r\n            () => route.query,\r\n            newV => {\r\n                init();\r\n                if (newV.desc == \"true\") {\r\n                    nextTick(() => {\r\n                        state.descRef.focus();\r\n                    });\r\n                }\r\n            },\r\n            {\r\n                immediate: true,\r\n            }\r\n        );\r\n        const handleSave = () => {\r\n            //更新歌单\r\n            const { name, tags, desc } = state;\r\n            if (!name) return state.commonToast.warn(\"歌单名不能为空\");\r\n            updatePlayListApi({ name, tags: tags.map(item => item.name).join(\";\"), desc, id: route.query.id as string }).then(\r\n                (res: AxiosResponseProps) => {\r\n                    if (res.code === 200) {\r\n                        state.commonToast.success(\"歌单信息更新成功\");\r\n                        //   //上传封面\r\n                        if (!state.formData || !state.formData.get(\"imgFile\")) {\r\n                            init();\r\n                            return store.dispatch(\"getCreatedMusicList\");\r\n                        }\r\n                        updatePlayListCoverApi(state.formData)\r\n                            .then((res: AxiosResponseProps) => {\r\n                                if (res.code === 200) {\r\n                                    init();\r\n                                    store.dispatch(\"getCreatedMusicList\");\r\n                                    state.commonToast.success(\"歌单封面更新成功\");\r\n                                } else {\r\n                                    state.commonToast.success(res.msg || \"歌单封面更新失败,可能原因为图片过大\");\r\n                                }\r\n                            })\r\n                            .catch(err => {\r\n                                state.commonToast.success(err.msg || \"歌单封面更新失败,可能原因为图片过大\");\r\n                            });\r\n                    }\r\n                }\r\n            );\r\n        };\r\n        const getHighqualityTags = () => {\r\n            getHighqualityTagsApi().then((res: any) => {\r\n                if (res.code === 200) {\r\n                    state.tagList = res.tags\r\n                        //确认category的个数\r\n                        .reduce((pre2, item2) => (pre2.map(item3 => item3.category).includes(item2.category) ? pre2 : [...pre2, item2]), [])\r\n                        //把category相同的tag放入当前项\r\n                        .map(item4 => res.tags.filter(item5 => item5.category == item4.category));\r\n                }\r\n            });\r\n        };\r\n        getHighqualityTags();\r\n        const modalConfirm = () => {\r\n            state.tags = [...state.mergedTagList.filter(item => item.active)];\r\n            state.modalVisible = false;\r\n        };\r\n        const clickTagItem = tag => {\r\n            if (tag.active) {\r\n                tag.active = false;\r\n            } else {\r\n                if (state.mergedTagList.filter(item => item.active).length < 3) {\r\n                    tag.active = true;\r\n                } else {\r\n                    state.commonToast.warn(\"最多可选三个标签\");\r\n                }\r\n            }\r\n        };\r\n        return {\r\n            ...toRefs(state),\r\n            handleEditCover,\r\n            handleSave,\r\n            modalConfirm,\r\n            clickTagItem,\r\n        };\r\n    },\r\n});\r\n","import { render } from \"./updateMusicList.vue?vue&type=template&id=66693a88&scoped=true\"\nimport script from \"./updateMusicList.vue?vue&type=script&lang=ts\"\nexport * from \"./updateMusicList.vue?vue&type=script&lang=ts\"\n\nimport \"./updateMusicList.vue?vue&type=style&index=0&id=66693a88&scoped=true&lang=scss\"\nscript.render = render\nscript.__scopeId = \"data-v-66693a88\"\n\nexport default script","export * from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/stylePostLoader.js!../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/index.js??ref--0-1!./updateMusicList.vue?vue&type=style&index=0&id=66693a88&scoped=true&lang=scss\""],"sourceRoot":""}